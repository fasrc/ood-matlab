#!/usr/bin/env bash

# Clean the environment
module purge

# Set working directory to home directory
cd "${HOME}"

#
# Launch Xfce Window Manager and Panel
#

(
  export SEND_256_COLORS_TO_REMOTE=1
  export XDG_CONFIG_HOME="<%= session.staged_root.join("config") %>"
  export XDG_DATA_HOME="<%= session.staged_root.join("share") %>"
  export XDG_CACHE_HOME="$(mktemp -d)"
  module restore
  set -x
  xfwm4 --compositor=off --daemon --sm-client-disable
  xsetroot -solid "#D3D3D3"
  xfsettingsd --sm-client-disable
  xfce4-panel --sm-client-disable
) &

#
# Start COMSOL Multiphysics
#

set -x

# Load the required environment
<%- if context.matlab_version === "/n/scratchssdlfs/rc_admin/francesco/matlab-2018-el7-7.4.1708.img matlab -softwareopengl" -%>

singularity exec <%= context.matlab_version %>


<%- else -%>

module load <%= context.matlab_version %>
matlab -desktop -softwareopengl 

<%- end  -%>

# Launch COMSOL Multiphysics
##- if gpu -
##module load intel/16.0.3 virtualgl
##module list
##set -x
##vglrun comsol
##- else -
##module list
##set -x
##comsol -3drend sw
##- end -
